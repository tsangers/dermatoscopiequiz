<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DermMatch – Stichting HUID (Volledige versie)</title>
  <meta name="description" content="DermMatch – Stichting HUID. Oefenplatform voor huisartsen en AIOS: dermatoscopie naevus vs. melanoom. Beelden: ISIC Archive.">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* light gradient background */
    body { background: linear-gradient(180deg, #fffaf7, #ffffff 40%); }
  </style>
</head>
<body class="text-slate-900">
  <div id="app" class="max-w-5xl mx-auto p-4 sm:p-6"></div>

  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <script>
  ;(() => {
    const { useEffect, useMemo, useRef, useState } = React;

    // -----------------------
    // Data types & helpers
    // -----------------------
    const SAMPLES = [
      { id: "ISIC_0000000", label: "nevus" },
      { id: "ISIC_0000001", label: "nevus" },
      { id: "ISIC_0000002", label: "melanoma" },
      { id: "ISIC_0000003", label: "nevus" },
      { id: "ISIC_0000004", label: "melanoma" },
      { id: "ISIC_0000005", label: "nevus" },
      { id: "ISIC_0000006", label: "nevus" },
      { id: "ISIC_0000007", label: "nevus" },
      { id: "ISIC_0000008", label: "nevus" },
      { id: "ISIC_0000009", label: "nevus" },
      { id: "ISIC_0000010", label: "nevus" },
      { id: "ISIC_0000011", label: "nevus" },
      { id: "ISIC_0000012", label: "nevus" },
      { id: "ISIC_0000013", label: "melanoma" },
      { id: "ISIC_0000014", label: "nevus" },
      { id: "ISIC_0000015", label: "nevus" },
      { id: "ISIC_0000016", label: "nevus" },
      { id: "ISIC_0000017", label: "nevus" },
      { id: "ISIC_0000019", label: "nevus" },
      { id: "ISIC_0000020", label: "nevus" },
      { id: "ISIC_0000021", label: "nevus" },
      { id: "ISIC_0000022", label: "melanoma" },
      { id: "ISIC_0000023", label: "nevus" },
      // HAM10000 examples
      { id: "ISIC_0024306", label: "nevus" },
      { id: "ISIC_0024307", label: "nevus" },
      { id: "ISIC_0024308", label: "nevus" },
      { id: "ISIC_0024309", label: "nevus" },
      { id: "ISIC_0024310", label: "melanoma" },
      { id: "ISIC_0024311", label: "nevus" },
      { id: "ISIC_0024312", label: "melanoma" },
      { id: "ISIC_0024313", label: "nevus" },
      { id: "ISIC_0024314", label: "melanoma" },
      { id: "ISIC_0024316", label: "nevus" },
      { id: "ISIC_0024319", label: "nevus" },
      { id: "ISIC_0024320", label: "nevus" },
      { id: "ISIC_0024321", label: "nevus" },
      { id: "ISIC_0024322", label: "melanoma" },
    ];

    const isicImageUrl = (id) => `https://isic-archive.s3.amazonaws.com/images/${id}.jpg`;
    const isicThumbUrl = (id) => `https://isic-archive.s3.amazonaws.com/thumbnails/${id}_thumbnail.jpg`;
    const isicPageUrl  = (id) => `https://api.isic-archive.com/images/${id}/`;

    function xmur3(str) {
      let h = 1779033703 ^ str.length;
      for (let i = 0; i < str.length; i++) {
        h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
        h = (h << 13) | (h >>> 19);
      }
      return function () {
        h = Math.imul(h ^ (h >>> 16), 2246822507);
        h = Math.imul(h ^ (h >>> 13), 3266489909);
        return (h ^= h >>> 16) >>> 0;
      };
    }
    function mulberry32(a) {
      return function () {
        let t = (a += 0x6d2b79f5);
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }
    function seededShuffle(arr, seed) {
      const rand = mulberry32(xmur3(seed || '')());
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(rand() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    function pickBalanced(samples, n, seed) {
      const nev = samples.filter((s) => s.label === "nevus");
      const mel = samples.filter((s) => s.label === "melanoma");
      const perClass = Math.min(Math.floor(n / 2), Math.min(nev.length, mel.length));
      const seedNev = seededShuffle(nev, seed + "N").slice(0, perClass);
      const seedMel = seededShuffle(mel, seed + "M").slice(0, perClass);
      const rest = n - (seedNev.length + seedMel.length);
      const pool = seededShuffle(samples, seed + "R");
      const extra = [];
      for (const s of pool) {
        if (extra.length >= rest) break;
        if (!seedNev.includes(s) && !seedMel.includes(s)) extra.push(s);
      }
      return seededShuffle([...seedNev, ...seedMel, ...extra], seed + "F");
    }

    // -----------------------
    // Tiny SVG icons
    // -----------------------
    const IconCrown = (props) => (
      React.createElement('svg', { viewBox: '0 0 24 24', width: 20, height: 20, fill: 'none', stroke: 'currentColor', strokeWidth: 2, ...props },
        React.createElement('path', { d: 'M3 7l4 4 5-8 5 8 4-4v13H3z' })
      )
    );
    const IconTrophy = (props) => (
      React.createElement('svg', { viewBox: '0 0 24 24', width: 20, height: 20, fill: 'none', stroke: 'currentColor', strokeWidth: 2, ...props },
        React.createElement('path', { d: 'M8 21h8M12 17a6 6 0 0 0 6-6V4H6v7a6 6 0 0 0 6 6z' }),
        React.createElement('path', { d: 'M18 5h3a3 3 0 0 1-3 3M6 5H3a3 3 0 0 0 3 3' })
      )
    );
    const IconShuffle = (props) => (
      React.createElement('svg', { viewBox: '0 0 24 24', width: 18, height: 18, fill: 'none', stroke: 'currentColor', strokeWidth: 2, ...props },
        React.createElement('path', { d: 'M16 3h5v5' }),
        React.createElement('path', { d: 'M4 20l16-16' }),
        React.createElement('path', { d: 'M21 16v5h-5' }),
        React.createElement('path', { d: 'M15 15l6 6' })
      )
    );
    const IconShare = (props) => (
      React.createElement('svg', { viewBox: '0 0 24 24', width: 18, height: 18, fill: 'none', stroke: 'currentColor', strokeWidth: 2, ...props },
        React.createElement('circle', { cx: 18, cy: 5, r: 3 }),
        React.createElement('circle', { cx: 6, cy: 12, r: 3 }),
        React.createElement('circle', { cx: 18, cy: 19, r: 3 }),
        React.createElement('path', { d: 'M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98' })
      )
    );

    // -----------------------
    // Core components
    // -----------------------
    const Chip = ({ children }) => (
      React.createElement('span', { className: 'inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs font-medium' }, children)
    );

    const ZoomableImage = ({ id }) => {
      const [zoom, setZoom] = useState(false);
      return React.createElement('div', { className: 'relative w-full aspect-[4/3] overflow-hidden rounded-2xl bg-slate-100' },
        React.createElement('img', {
          src: isicImageUrl(id),
          alt: id,
          className: 'h-full w-full object-contain transition-transform ' + (zoom ? 'scale-110' : 'scale-100'),
          onClick: () => setZoom((z) => !z),
          onError: (e) => { e.currentTarget.src = isicThumbUrl(id); }
        }),
        React.createElement('div', { className: 'absolute bottom-2 right-2 hidden sm:flex items-center gap-2' },
          React.createElement('button', {
            onClick: () => setZoom((z) => !z),
            className: 'rounded-full border border-slate-300 bg-white/80 px-2 py-1 text-xs backdrop-blur hover:bg-white'
          }, zoom ? '−' : '+'),
          React.createElement('a', { href: isicPageUrl(id), target: '_blank', rel: 'noreferrer', className: 'text-xs underline opacity-80' }, 'Open in ISIC')
        )
      );
    };

    const ShareLink = ({ seed, rounds }) => {
      const url = (() => {
        const base = location.origin + location.pathname;
        const params = new URLSearchParams();
        params.set('seed', seed);
        params.set('r', String(rounds));
        return base + '?' + params.toString();
      })();
      const [copied, setCopied] = useState(false);
      async function copy() {
        try { await navigator.clipboard.writeText(url); setCopied(true); setTimeout(() => setCopied(false), 1200); } catch {}
      }
      return React.createElement('div', { className: 'flex items-center gap-2' },
        React.createElement('input', { readOnly: true, value: url, className: 'text-xs w-full border border-slate-200 rounded-lg px-2 py-2' }),
        React.createElement('button', { onClick: copy, className: 'rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm' }, copied ? 'Gekopieerd!' : 'Kopieer')
      );
    };

    // -----------------------
    // App
    // -----------------------
    function DermMatchApp() {
      const params = new URLSearchParams(location.search);
      const qSeed = params.get('seed') || '';
      const qRounds = params.get('r') || '';

      const [mode, setMode] = useState(qSeed ? 'duel' : 'solo');
      const [rounds, setRounds] = useState(qRounds ? Number(qRounds) || 10 : 10);
      const [seed, setSeed] = useState(qSeed || Math.random().toString(36).slice(2, 10));
      const [started, setStarted] = useState(false);

      const [sequence, setSequence] = useState([]);
      const [index, setIndex] = useState(0);
      const [answers, setAnswers] = useState([]);
      const [currentStart, setCurrentStart] = useState(null);
      const [locked, setLocked] = useState(false);

      const pool = useMemo(() => SAMPLES, []);
      const current = sequence[index];
      const progress = sequence.length ? Math.round((index / sequence.length) * 100) : 0;
      const score = answers.filter((a) => a.correct).length;
      const streak = useMemo(() => {
        let s = 0;
        for (let i = answers.length - 1; i >= 0; i--) { if (answers[i].correct) s++; else break; }
        return s;
      }, [answers]);
      const finished = started && sequence.length > 0 && index === sequence.length - 1 && answers.length === sequence.length;

      function startGame() {
        if (mode === 'duel') {
          const p = new URLSearchParams(); p.set('seed', seed); p.set('r', String(rounds));
          history.replaceState(null, '', '?' + p.toString());
        } else {
          history.replaceState(null, '', location.pathname);
        }
        const seq = pickBalanced(pool, rounds, seed);
        setSequence(seq);
        setIndex(0);
        setAnswers([]);
        setCurrentStart(performance.now());
        setLocked(false);
        setStarted(true);
      }

      function reset() {
        setStarted(false);
        setSequence([]);
        setIndex(0);
        setAnswers([]);
        setCurrentStart(null);
        setLocked(false);
      }

      function choose(label) {
        if (!current || locked) return;
        setLocked(true);
        const rt = currentStart ? performance.now() - currentStart : 0;
        const correct = current.label === label;
        setAnswers((prev) => [...prev, { id: current.id, correct, chosen: label, truth: current.label, ms: Math.round(rt) }]);
        setTimeout(() => {
          if (index + 1 < sequence.length) {
            setIndex(index + 1);
            setCurrentStart(performance.now());
            setLocked(false);
          } else {
            setLocked(false);
          }
        }, 500);
      }

      // keyboard shortcuts
      useEffect(() => {
        function onKey(e) {
          if (!started || finished) return;
          if (e.key === 'n' || e.key === 'N') choose('nevus');
          if (e.key === 'm' || e.key === 'M') choose('melanoma');
        }
        addEventListener('keydown', onKey);
        return () => removeEventListener('keydown', onKey);
      }, [started, finished, currentStart, index, sequence, locked]);

      return React.createElement('div', null,
        // Top bar
        React.createElement('div', { className: 'flex items-center justify-between gap-3 py-4' },
          React.createElement('div', { className: 'flex items-center gap-3' },
            React.createElement(IconCrown, { className: 'w-6 h-6 text-teal-600' }),
            React.createElement('h1', { className: 'text-xl sm:text-2xl font-semibold' }, 'DermMatch · Stichting HUID')
          ),
          React.createElement('div', { className: 'text-xs opacity-70 hidden sm:block' }, 'Beelden: ISIC Archive • Alleen voor onderwijs • Geen medisch advies')
        ),

        // Setup card
        !started && React.createElement('div', { className: 'rounded-2xl border border-slate-200 bg-white shadow-md overflow-hidden mb-6' },
          React.createElement('div', { className: 'p-4 sm:p-6 space-y-2 border-b border-slate-200' },
            React.createElement('div', { className: 'text-lg sm:text-xl font-semibold' }, 'Start een wedstrijd'),
            React.createElement('div', { className: 'text-sm opacity-80' }, 'Doel: onderscheid een ', React.createElement('strong', null, 'naevus'), ' van een ', React.createElement('strong', null, 'melanoom'), ' op dermatoscopie (huisartsen/AIOS).')
          ),
          React.createElement('div', { className: 'p-4 sm:p-6 grid gap-4 sm:grid-cols-3' },
            React.createElement('div', { className: 'space-y-2' },
              React.createElement('label', { className: 'text-sm' }, 'Modus'),
              React.createElement('select', {
                className: 'w-full border border-slate-200 rounded-lg px-3 py-2',
                value: mode,
                onChange: (e) => setMode(e.target.value)
              }, [
                React.createElement('option', { key: 'solo', value: 'solo' }, 'Solo'),
                React.createElement('option', { key: 'duel', value: 'duel' }, 'Duel (deelbare seed)')
              ])
            ),
            React.createElement('div', { className: 'space-y-2' },
              React.createElement('label', { className: 'text-sm' }, 'Rondes'),
              React.createElement('input', {
                type: 'number', min: 6, max: 50,
                className: 'w-full border border-slate-200 rounded-lg px-3 py-2',
                value: rounds,
                onChange: (e) => setRounds(Number(e.target.value))
              })
            ),
            React.createElement('div', { className: 'space-y-2' },
              React.createElement('label', { className: 'text-sm' }, 'Seed (voorzelfde volgorde)'),
              React.createElement('div', { className: 'flex gap-2' },
                React.createElement('input', {
                  className: 'w-full border border-slate-200 rounded-lg px-3 py-2',
                  value: seed,
                  onChange: (e) => setSeed(e.target.value)
                }),
                React.createElement('button', {
                  onClick: () => setSeed(Math.random().toString(36).slice(2, 10)),
                  className: 'inline-flex items-center gap-1 rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm'
                }, React.createElement(IconShuffle, null), 'Nieuw')
              )
            )
          ),
          React.createElement('div', { className: 'px-4 sm:px-6 pb-4 sm:pb-6 flex items-center justify-between gap-3' },
            React.createElement('div', { className: 'text-xs opacity-70' }, 'Gemaakt door ', React.createElement('strong', null, 'Stichting HUID'), ' (nascholing dermatologie). Voor training en toetsing door huisartsen en AIOS.'),
            React.createElement('button', {
              onClick: startGame,
              className: 'rounded-2xl bg-gradient-to-r from-teal-500 to-indigo-500 text-white font-semibold px-5 py-2.5'
            }, 'Start')
          )
        ),

        // Game view
        started && !finished && current && React.createElement('div', { className: 'grid gap-4 lg:grid-cols-3' },
          React.createElement('div', { className: 'lg:col-span-2 space-y-4' },
            React.createElement('div', { className: 'rounded-2xl border border-slate-200 bg-white shadow-md overflow-hidden' },
              React.createElement('div', { className: 'p-4 flex items-center justify-between border-b border-slate-200' },
                React.createElement('div', { className: 'font-semibold' }, `Ronde ${index + 1} / ${sequence.length}`),
                React.createElement('div', { className: 'flex items-center gap-2 text-sm' },
                  React.createElement(Chip, null, 'Score: ', score),
                  React.createElement(Chip, null, 'Streak: ', streak)
                )
              ),
              React.createElement('div', { className: 'p-4' }, React.createElement(ZoomableImage, { id: current.id })),
              React.createElement('div', { className: 'p-4 grid grid-cols-2 gap-3 border-t border-slate-200' },
                React.createElement('button', { disabled: locked, onClick: () => choose('nevus'), className: 'h-14 rounded-2xl text-lg font-semibold border border-emerald-200 bg-emerald-50 hover:bg-emerald-100' }, 'Naevus'),
                React.createElement('button', { disabled: locked, onClick: () => choose('melanoma'), className: 'h-14 rounded-2xl text-lg font-semibold border border-rose-200 bg-rose-50 hover:bg-rose-100' }, 'Melanoom')
              )
            ),
            React.createElement('div', { className: 'space-y-2' },
              React.createElement('div', { className: 'h-2 w-full rounded-full bg-slate-100 overflow-hidden' },
                React.createElement('div', { style: { width: progress + '%' }, className: 'h-full bg-gradient-to-r from-teal-500 to-indigo-500' })
              ),
              React.createElement('div', { className: 'flex items-center justify-between text-xs opacity-70' },
                React.createElement('span', null, 'Vooruitgang'),
                React.createElement('span', null, progress + '%')
              )
            )
          ),
          React.createElement('div', { className: 'space-y-4' },
            React.createElement('div', { className: 'rounded-2xl border border-slate-200 bg-white shadow-md overflow-hidden' },
              React.createElement('div', { className: 'p-4 border-b border-slate-200 font-semibold' }, 'Laatste antwoord'),
              React.createElement('div', { className: 'p-4 text-sm' },
                answers.length > 0
                  ? React.createElement('div', {
                      className: 'p-3 rounded-xl border ' + (answers[answers.length - 1].correct ? 'bg-emerald-50 border-emerald-200' : 'bg-rose-50 border-rose-200')
                    },
                    answers[answers.length - 1].correct ? 'Correct' : 'Onjuist',
                    ' – waarheid: ',
                    React.createElement('strong', null, answers[answers.length - 1].truth === 'nevus' ? 'Naevus' : 'Melanoom'),
                    React.createElement('div', { className: 'text-xs opacity-70 mt-1' }, answers[answers.length - 1].ms, ' ms • ', (sequence[index]?.id || answers[answers.length - 1].id))
                  )
                  : React.createElement('div', { className: 'text-slate-500' }, 'Nog geen antwoord')
              ),
              React.createElement('div', { className: 'px-4 pb-4 text-xs text-slate-500' }, 'Tip: klik op de afbeelding voor zoom • "Open in ISIC" toont metadata & licentie')
            ),
            React.createElement('div', { className: 'rounded-2xl border border-slate-200 bg-white shadow-md overflow-hidden' },
              React.createElement('div', { className: 'p-4 border-b border-slate-200 font-semibold' }, 'Deelbare wedstrijd'),
              React.createElement('div', { className: 'p-4 space-y-2' },
                React.createElement('div', { className: 'text-sm' }, 'Iedereen met dezelfde ', React.createElement('em', null, 'seed'), ' en ', React.createElement('em', null, 'rondes'), ' krijgt exact dezelfde volgorde.'),
                React.createElement(ShareLink, { seed, rounds })
              )
            ),
            React.createElement('button', { onClick: reset, className: 'w-full rounded-xl border border-slate-200 bg-slate-50 py-2.5' }, 'Herstart')
          )
        ),

        // Results
        finished && React.createElement('div', { className: 'rounded-2xl border border-slate-200 bg-white shadow-md overflow-hidden mt-6' },
          React.createElement('div', { className: 'p-4 flex items-center justify-between border-b border-slate-200' },
            React.createElement('div', { className: 'flex items-center gap-2 font-semibold text-lg' },
              React.createElement(IconTrophy, { className: 'w-5 h-5 text-indigo-600' }), 'Uitslag'
            ),
            React.createElement(Chip, null, 'Seed: ', seed, ' · r=', String(rounds))
          ),
          React.createElement('div', { className: 'p-4 grid gap-4 md:grid-cols-2' },
            React.createElement('div', { className: 'space-y-1' },
              React.createElement('div', { className: 'text-4xl font-semibold' }, String(answers.filter((a) => a.correct).length), ' / ', String(answers.length)),
              React.createElement('div', { className: 'text-sm opacity-80' }, 'Gem. reactietijd: ', String(Math.round(answers.reduce((s, a) => s + a.ms, 0) / Math.max(answers.length, 1))), ' ms'),
              React.createElement('div', { className: 'text-sm opacity-80' }, 'Acc.: ', String(Math.round((answers.filter((a) => a.correct).length / Math.max(1, answers.length)) * 100)), '%')
            ),
            React.createElement('div', { className: 'space-y-2 text-sm' },
              React.createElement('div', { className: 'font-medium' }, 'Gemiste cases'),
              React.createElement('ul', { className: 'list-disc pl-5 space-y-1 max-h-48 overflow-auto' },
                answers.filter((a) => !a.correct).length === 0
                  ? React.createElement('li', null, 'Geen – nette score 🎉')
                  : answers.filter((a) => !a.correct).map((a) =>
                      React.createElement('li', { key: a.id },
                        a.id, ' · juist: ', a.truth === 'nevus' ? 'Naevus' : 'Melanoom', ' · ',
                        React.createElement('a', { className: 'underline', href: isicPageUrl(a.id), target: '_blank', rel: 'noreferrer' }, 'ISIC')
                      )
                    )
              )
            )
          ),
          React.createElement('div', { className: 'p-4 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between' },
            React.createElement('div', { className: 'text-xs opacity-70' }, 'Voor live leaderboard/elo: voeg een eenvoudige backend toe (bijv. Supabase/Firebase).'),
            React.createElement('div', { className: 'flex gap-2 items-center' },
              React.createElement('button', { onClick: reset, className: 'rounded-xl border border-slate-200 bg-slate-50 px-3 py-2' }, 'Opnieuw'),
              React.createElement(ShareLink, { seed, rounds })
            )
          )
        ),

        // Footer
        React.createElement('div', { className: 'mt-8 text-xs text-slate-500 space-y-1' },
          React.createElement('div', null,
            'Afbeeldingen afkomstig uit het ISIC Archive (o.a. HAM10000). Raadpleeg per afbeelding de ISIC-pagina voor ',
            React.createElement('span', { className: 'underline' }, 'licentie/attributie'),
            ' en metadata. Dit platform is uitsluitend voor onderwijs en oefening door zorgprofessionals en is ',
            React.createElement('strong', null, 'geen'), ' medisch hulpmiddel of advies.'
          ),
          React.createElement('div', null,
            'Doelgroep: ', React.createElement('strong', null, 'huisartsen en AIOS'), '. Versie: volledige single-file React build (zonder bundler).'
          )
        )
      );
    }

    // Mount
    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(React.createElement(DermMatchApp));
  })();
  </script>
</body>
</html>
